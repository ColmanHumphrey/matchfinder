<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finding Best Matches Based on Predictability • matchfinder</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Finding Best Matches Based on Predictability">
<meta property="og:description" content="Finds the best set of matches to use in a bipartite (treatment/control) or non-bipartite setting,
    where best refers to predictability.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">matchfinder</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="matchfinder" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#matchfinder" class="anchor"></a>matchfinder</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p><code>matchfinder</code> is for finding best matches based on predictability. The general idea: a given match is bad if we can predict which units are treated and which are control.</p>
<div id="main-concept" class="section level2">
<h2 class="hasAnchor">
<a href="#main-concept" class="anchor"></a>Main Concept</h2>
<p>First let’s discuss the case of matched pairs:</p>
<ul>
<li>We have a set of <code>T</code> treatment units and <code>C</code> control units, for a total of <code>N = T + C</code> units</li>
<li>We form <code>n</code> pairs, where <code>n ≤ T, n ≤ C</code>
<ul>
<li>Each pair consists of one treated unit and one control unit</li>
<li>Typically we restrict each treated unit to show up at most once in all pairs</li>
<li>Optionally we can restrict the control units the same way</li>
</ul>
</li>
<li>We may leave out some or many of the original units</li>
<li>The groups of units, all resulting matched treated units, and all resulting matched control units, shouldn’t differ systematically, to reduce bias</li>
<li>The units within each pair should be similar, to reduce variance</li>
</ul>
<p>However, it isn’t enough to evaluate group-level statistics for the bias part: say we have some variable <code>x</code> and in our pairs of (treated, control), it only takes the values (0, 1), (1, 2), (2, 3) and (3, 0), each 25% of the time. Then the variable will have the same group-level statistics for treated and control units, but there’s a clear pattern in the data. If <code>x</code> has some non-linear effect on the outcome, this would bias our results.</p>
<p>If you were given half the pairs, along with all relevant info about the pairs (values of <code>x</code>, which unit is treated etc), you could quickly learn the pattern given and easily predict which unit is the treated when looking at the other half. This means it’s easy to predict which units are the treated units, and our match is bad.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>We’re not yet on <a href="https://CRAN.R-project.org">CRAN</a>, but you can install from github with <code>devtools</code> or <code>remotes</code>:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co">## install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"ColmanHumphrey/matchfinder"</span>)

<span class="co">## OR:</span>

<span class="co">## install.packages("remotes")</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"ColmanHumphrey/matchfinder"</span>)</pre></div>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>We’ll work through two small examples, one bipartite, one non-bipartite.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co">## We'll load the library in either case</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">matchfinder</span>)</pre></div>
<div id="bipartite" class="section level3">
<h3 class="hasAnchor">
<a href="#bipartite" class="anchor"></a>Bipartite</h3>
<div class="sourceCode" id="cb3"><pre class="r">    <span class="no">rows</span> <span class="kw">&lt;-</span> <span class="fl">100L</span>
    <span class="no">num_weight_vecs</span> <span class="kw">&lt;-</span> <span class="fl">5L</span>
    <span class="no">x_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">rows</span>),
                   <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="no">rows</span>))
    <span class="no">treat_vec</span> <span class="kw">&lt;-</span> (<span class="fl">1L</span>:<span class="no">rows</span>) <span class="kw">%in%</span> <span class="fu"><a href="reference/fixed_sample.html">fixed_sample</a></span>(<span class="fl">1L</span>:<span class="no">rows</span>,
                                             <span class="fl">45L</span>)
    <span class="no">y_vector</span> <span class="kw">&lt;-</span> <span class="no">x_mat</span>[, <span class="fl">1</span>] + <span class="no">x_mat</span>[, <span class="fl">2</span>] + <span class="no">treat_vec</span> * <span class="fl">0.3</span>
    <span class="no">cov_x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/covariance_with_ranks.html">covariance_with_ranks</a></span>(<span class="no">x_mat</span>)

    <span class="no">some_dist_mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/weighted_mahal.html">weighted_mahal</a></span>(<span class="no">x_mat</span>,
                                    <span class="kw">cov_x</span> <span class="kw">=</span> <span class="no">cov_x</span>,
                                    <span class="kw">weight_vec</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.66</span>, <span class="fl">0.33</span>),
                                    <span class="kw">treat_vec</span> <span class="kw">=</span> <span class="no">treat_vec</span>)

    <span class="no">weight_vecs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/generate_random_weights.html">generate_random_weights</a></span>(<span class="kw">prior_weights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">1</span>),
                                           <span class="kw">number_vectors</span> <span class="kw">=</span> <span class="no">num_weight_vecs</span>,
                                           <span class="kw">minimum_weights</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>))

    <span class="no">all_wr_matches</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/all_bipartite_matches.html">all_bipartite_matches</a></span>(<span class="kw">x_mat</span> <span class="kw">=</span> <span class="no">x_mat</span>,
                                            <span class="kw">cov_x</span> <span class="kw">=</span> <span class="no">cov_x</span>,
                                            <span class="kw">weight_list</span> <span class="kw">=</span> <span class="no">weight_vecs</span>,
                                            <span class="kw">treat_vec</span> <span class="kw">=</span> <span class="no">treat_vec</span>,
                                            <span class="kw">match_method</span> <span class="kw">=</span> <span class="st">"with_replacement"</span>,
                                            <span class="kw">n_sinks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0L</span>, <span class="fl">4L</span>))

    <span class="no">sink_brier_wr_matches</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/sink_brier_bipartite_matches.html">sink_brier_bipartite_matches</a></span>(
        <span class="kw">x_mat</span> <span class="kw">=</span> <span class="no">x_mat</span>,
        <span class="kw">cov_x</span> <span class="kw">=</span> <span class="no">cov_x</span>,
        <span class="kw">weight_list</span> <span class="kw">=</span> <span class="no">weight_vecs</span>,
        <span class="kw">treat_vec</span> <span class="kw">=</span> <span class="no">treat_vec</span>,
        <span class="kw">match_method</span> <span class="kw">=</span> <span class="st">"with_replacement"</span>,
        <span class="kw">n_sinks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0L</span>, <span class="fl">4L</span>),
        <span class="kw">silent</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></div>
</div>
<div id="non-bipartite" class="section level3">
<h3 class="hasAnchor">
<a href="#non-bipartite" class="anchor"></a>Non Bipartite</h3>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>LGPL (&gt;= 2.1)</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Colman Humphrey <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Colman Humphrey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
